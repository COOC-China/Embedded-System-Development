#1.1.2 嵌入式系统构成

##1．嵌入式系统架构概述

嵌入式系统由软件和硬件构成。硬件部分包括微处理器、内存、闪存/硬盘、外部设备等。软件部分则包括引导器、操作系统、文件系统、用户程序等。对于简单嵌入式系统来说，硬件部分通常只是一块单片机芯片，集成了所需的全部硬件资源，而软件部分则只是一个单一的二进制文件，包含全部的代码、常数、存储分配结构等。本书研究基于ARM处理器和嵌入式系统操作系统的复杂嵌入式系统。

##2．嵌入式系统概述

嵌入式系统是一种基于Linux内核的自由及开放源代码的操作系统，主要使用于移动设备，如智能手机和平板电脑，由Google公司和开放手机联盟领导及开发。嵌入式系统操作系统最初由Andy Rubin开发，主要支持手机。2005年8月由Google收购注资。2007年11月，Google与84家硬件制造商、软件开发商及电信营运商组建开放手机联盟共同研发改良嵌入式系统。随后Google以Apache开源许可证的授权方式，发布了嵌入式系统的源代码。第一部嵌入式系统智能手机HTC G1发布于2008年10月。嵌入式系统逐渐扩展到平板电脑及其他领域上，如电视、数码相机、游戏机等。2011年第一季度，嵌入式系统在全球的市场份额首次超过塞班系统，跃居全球第一。 嵌入式系统一词的本义指“机器人”，该平台由操作系统、中间件、用户界面和应用软件组成。

2008年，在GoogleI/O大会上，谷歌提出了嵌入式系统 HAL架构图，在同年08月18日，嵌入式系统获得了美国联邦通信委员会的批准。在2008年09月，谷歌正式发布了嵌入式系统 1.0系统，这也是嵌入式系统最早的版本。

2009年4月，谷歌正式推出了嵌入式系统 1.5，从嵌入式系统 1.5版本开始，谷歌开始将嵌入式系统的版本以甜品的名字命名，嵌入式系统 1.5命名为Cupcake。该系统与嵌入式系统 1.0相比有了很大的改进。

2009年09月份，谷歌发布了嵌入式系统 1.6的正式版，并且推出了搭载嵌入式系统 1.6正式版的HTC G3手机，凭借着出色的外观设计以及全新的嵌入式系统 1.6操作系统，HTC G3成为当时全球最受欢迎的手机。嵌入式系统 1.6也有一个有趣的甜品名称，即Donut。

2010年2月份，Linux内核开发者Greg Kroah-Hartman将嵌入式系统的驱动程序从Linux内核staging tree上除去。从此，嵌入式系统与Linux开发主流分道扬镳。在同年5月份，谷歌正式发布了嵌入式系统 2.2操作系统。谷歌将嵌入式系统 2.2操作系统命名为Froyo。

2010年10月份，谷歌宣布嵌入式系统达到了第一个里程碑，即电子市场上获得官方数字认证的嵌入式系统应用数量已经达到了10万个，嵌入式系统的应用增长非常迅速。在2010年12月，谷歌正式发布了嵌入式系统 2.3操作系统Gingerbread。

2011年1月，谷歌宣布每日的嵌入式系统设备新用户数量达到了30万部，到2011年7月，这个数字增长到55万部，而嵌入式系统设备的用户总数达到了1.35亿，嵌入式系统已经成为智能手机领域占有量最高的系统。

2011年8月2日，嵌入式系统手机已占据全球智能机市场48%的份额，并在亚太地区市场占据统治地位，终结了Symbian的霸主地位，跃居全球第一。

2011年9月份，嵌入式系统的应用数目已经达到了48万，而在智能手机市场，嵌入式系统的占有率已经达到了43%，继续排在移动操作系统首位。全新的嵌入式系统 4.0操作系统于2008年9月23日发布，这款系统被谷歌命名为Ice Cream Sandwich。

2012年01月6日，谷歌嵌入式系统 Market已有10万开发者推出超过40万活跃的应用，大多数的应用程序为免费。嵌入式系统 Market应用程序商店目录在新年首周周末突破40万基准，距离突破30万应用仅个月。在2011年早些时候，嵌入式系统 Market从20万增加到30万应用也花了四个月。

##3. 嵌入式系统的优势

(1).开放性  
在优势方面，嵌入式系统平台首先就是其开放性，开放的平台允许任何移动终端厂商加入到嵌入式系统联盟中来。显著的开放性可以使其拥有更多的开发者，随着用户数量的增多和应用的日益丰富，一个崭新的平台也将很快走向成熟。

(2).运营商的鼎力支持  
在国内，三大运营商是卯足了劲的推出嵌入式系统智能机。联通的“0元购机”，电信的千元3G，移动的索爱A8i定制机，都显示了运营商对嵌入式系统智能机的期望。在美国，T-Mobile、Sprint、AT&T和Verizon全部推出了嵌入式系统手机。此外，日本的KDDI，NTT DoCoMo，Telecom Italia(意大利电信)、T-Mobile (德国)、Telefónica( 西班牙)等众多运营商都是嵌入式系统的支持者。有这么多的运营商支持嵌入式系统，自然会占据巨大的市场份额。相对于嵌入式系统的运营商联盟，只有AT&T一家运营商销售iPhone。

(3).丰富的硬件选择  
这一点还是与嵌入式系统平台的开放性相关，由于嵌入式系统的开放性，众多的厂商会推出千奇百怪，功能特色各具的多种产品。功能上的差异和特色，却不会影响到数据同步，甚至软件的兼容、好比你从诺基亚Symbian风格手机一下改用苹果iPhone，同时还可将Symbian中优秀的软件带到iPhone上使用、联系人等资料更是可以方便地转移，是不是非常方便呢？现在，世界很多智能手机厂家几乎都加入了嵌入式系统阵营，并推出了一系列的嵌入式系统智能机。摩托罗拉、三星、HTC、LG、Lumigon等厂家都与谷歌建立了嵌入式系统平台技术联盟。厂商加盟的越多，手机终端就会越多，其市场潜力就越大。嵌入式系统智能机最近六个月在美国市场的占有率足以说明这一点。

(4).不受任何限制的开发商  
智能手机倚仗的是其上应用程序功能的实现，但是随着嵌入式系统的推广与普及，应用程序数量呈数量级增长，嵌入式系统应用在可预见的未来是有能力与苹果相竞争的。而来自嵌入式系统应用商店最大的优势是，不对应用程序进行严格的审查。

(5).无缝结合Google的应用  
如今互联网的Google已经走过10年的历史，从搜索巨人到全面的互联网渗透，Google服务如地图、邮件、搜索等已经成为连接用户和互联网的重要纽带，而嵌入式系统平台将无缝结合这些优秀的Google服务。

##4．基于嵌入式系统硬件构成

> ![](/images/1-5.png)  
> 图1-5 嵌入式系统嵌入式系统的硬件

为了支持嵌入式系统的正常运行，一个典型的系统应具备ARM嵌入式处理器、内存、闪存、电源管理系统、音频子系统、显示屏和触摸屏。

如图1-6所示，该图以基于全智科技的A10应用处理器的嵌入式系统为例，介绍了一个 无线IP电话硬件系统的构成。嵌入式系统操作系统运行在基于ARM核心的A10处理器上，而GPU部分运行图像加速算法。ARM处理器控制片上外设，片上外设控制系统的其他设备，比如音频控制器、背光控制器等。A10 SoC通过USB等接口对外实现有线和无线通信。

##5. 嵌入式系统软件构成

嵌入式系统软件部分包含引导器、操作系统、文件系统和用户程序等。以嵌入式系统为例，系统引导器（通常是U-Boot）在系统上电之后首先运行，该程序负责处理器的初始化、内存、闪存的初始化，并解压缩操作系统内核，然后将控制权交给操作系统。操作系统包含内核和用户态程序。嵌入式系统的内核是Linux，Linux在加载后挂载文件系统，并从中加载用户态程序。其中嵌入式系统的用户态程序包含启动管理、Java虚拟机、系统库函数等。在完成嵌入式系统的加载后，嵌入式系统会自动加载默认的桌面应用程序。至此，嵌入式系统完成启动过程。

> ![](/images/1-6.jpg)  
> 图1-6 嵌入式系统软件构成

引导器部分含设备相关的、与底层打交道的代码，这部分常用汇编语言和C语言编写。Linux内核部分包含部分设备相关代码，比如CPU的优化指令等，以及大量的外设驱动。这部分将是我们移植嵌入式系统的重点。嵌入式系统虚拟机和Linux用户态库文件提供应用程序与Linux内核沟通的机制，并实现大量的扩展功能。如果要开发自定义的嵌入式系统，就少不了开发指定的用户态库文件。如果嵌入式系统是用于特定目的的，一般还要为应用程序（APK）开发对应的底层库文件及JNI库。这部分也是嵌入式系统移植的重点。再上层是应用程序框架，该部分提供应用程序可以调用的Java包，它们实现了多数的嵌入式系统 API，是应用开发的重点。最上层是应用程序，该部分由第三方开发，与系统移植无关。